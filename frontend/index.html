<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CoopCred</title>
  <link rel="stylesheet" href="./css/index.css" />
  <link rel="icon" type="image/x-icon" href="./imgs/favicon.png" />
</head>

<body>
  <header>
    <div class="logo">
      <img src="./imgs/Logo.png" alt="Logo da CoopCred" />
    </div>
  </header>

  <section class="banner">
    <img src="./imgs/Hero_Section.png" alt="Fundo" class="background-image" />
    <div class="banner-overlay">
      <h1>Bem-vindo à CoopCred</h1>
      <p>Liderando o Agro, fortalecendo o seu Futuro</p>
    </div>
  </section>

  <section class="login-area">
    <div class="auth-container">
      <div class="tabs">
        <button class="tab-btn active" data-tab="login">Entrar</button>
        <button class="tab-btn" data-tab="register">Registrar</button>
      </div>
      
      <div class="form-container">
        <form id="login-form" class="auth-form active">
          <h2>Acessar Conta</h2>
          <input type="text" name="username" placeholder="Nome de Usuário" required />
          <input type="password" name="password" placeholder="Senha" required />
          <button type="submit">Entrar</button>
        </form>
      </div>
    </div>
  </section>

  <footer>
    &copy; 2025 CoopCred. Todos os direitos reservados.
  </footer>

  <script src="./js/config.js"></script>
  <script>
    const tabButtons = document.querySelectorAll('.tab-btn');
    const forms = document.querySelectorAll('.auth-form');
    
    tabButtons.forEach(button => {
      button.addEventListener('click', () => {
        tabButtons.forEach(btn => btn.classList.remove('active'));
        forms.forEach(form => form.classList.remove('active'));
        
        button.classList.add('active');
        
        const tabName = button.getAttribute('data-tab');
        document.getElementById(`${tabName}-form`).classList.add('active');
      });
    });

    const loginForm = document.getElementById('login-form');
    const registerForm = document.getElementById('register-form');
    const API = window.API_URL || 'http://44.204.138.207:3000';

    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(loginForm);
      const data = Object.fromEntries(formData.entries());

      try {
        const res = await fetch(`${API}/login`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        
        if (res.ok) {
          if (result.token) {
            localStorage.setItem('token', result.token);
          }
          
          window.location.href = 'dashboard.html';
        } else {
          alert(result.message || result.error || 'Erro ao fazer login');
        }
      } catch (error) {
        alert('Erro ao conectar com o servidor');
        console.error(error);
      }
    });

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(registerForm);
      const data = Object.fromEntries(formData.entries());
      
      if (data.password !== data.confirmarSenha) {
        alert('As senhas não coincidem');
        return;
      }
      
      delete data.confirmarSenha;

      try {
        const res = await fetch(`${API}/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });

        const result = await res.json();
        alert(result.message || result.error);
        
        if (res.ok) {
          document.querySelector('[data-tab="login"]').click();
          registerForm.reset();
        }
      } catch (error) {
        alert('Erro ao conectar com o servidor');
        console.error(error);
      }
    });
  </script>
</body>

</html>
